using System ;
using JetBrains.Annotations ;
using WpfApp.Core.Logging ;
using Xunit.Abstractions ;

namespace Tests.Lib.Fixtures
{
    /// <summary></summary>
    /// <autogeneratedoc />
    /// TODO Edit XML Comment Template for LoggingFixture
    [ UsedImplicitly ]
    public class LoggingFixture : IDisposable
    {
        public void SetOutputHelper ( ITestOutputHelper value )
        {
            if(_xunitTarget != null)
            {
             AppLoggingConfigHelper.RemoveTarget(_xunitTarget);                   _xunitTarget.Dispose();
            }

            _xunitTarget = new XunitTarget("Xunit"){ OutputHelper = value};
            AppLoggingConfigHelper.AddTarget(_xunitTarget);
        }

        private XunitTarget _xunitTarget ;

        /// <summary>
        ///     Initializes a new instance of the <see cref="T:System.Object" />
        ///     class.
        /// </summary>
        public LoggingFixture ( IMessageSink sink )
        {
            sink.OnMessage ( new Xunit.DiagnosticMessage ( "Constructing LoggingFixture." ) ) ;
            // _xunitSinkTarget = new XunitSinkTarget ( "Xunitsink" ) { Sink = sink } ;
            // AppLoggingConfigHelper.AddTarget ( _xunitSinkTarget )
            //
        }


        // ReSharper disable once IdentifierTypo

        /// <summary>Performs application-defined tasks associated with freeing, releasing, or resetting unmanaged resources.</summary>
        public void Dispose ( )
        {
            if ( _xunitTarget != null )
            {
                AppLoggingConfigHelper.RemoveTarget ( _xunitTarget ) ;
                _xunitTarget.Dispose ( ) ;
            }
        }
    }
}